<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mic Test Working</title>
</head>
<body>
  <h2>Mic Test: Speak something</h2>
  <button id="startBtn">Start Listening</button>

  <script>
    const startBtn = document.getElementById('startBtn');

    startBtn.addEventListener('click', async () => {
      // Step 1: request microphone access
      try {
        await navigator.mediaDevices.getUserMedia({ audio: true });
        console.log('ðŸŽ¤ Microphone access granted.');
      } catch (err) {
        console.error('ðŸŽ¤ Microphone access denied:', err);
        return;
      }

      // Step 2: setup SpeechRecognition
      window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!window.SpeechRecognition) {
        alert('Speech Recognition API not supported in this browser.');
        return;
      }

      const recognition = new window.SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = true;
      recognition.continuous = true;

      recognition.onstart = () => console.log('ðŸŽ¤ Listening... speak now!');

      recognition.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript.trim();
          if (transcript) console.log('ðŸ—£ You said:', transcript);
        }
      };

      recognition.onerror = (e) => {
        if (e.error === 'no-speech') console.log('ðŸŽ¤ No speech detected.');
        else console.error('ðŸŽ¤ Error:', e.error);
      };

      recognition.onend = () => {
        console.log('ðŸŽ¤ Recognition ended, restarting...');
        setTimeout(() => recognition.start(), 300);
      };

      recognition.start();
    });
  </script>
</body>
</html>
